{
  "name": "infra.setup_cloudflare_tunnel",
  "description": "Generate Cloudflare Tunnel sidecar configuration for a Docker Compose service. Produces a cloudflared compose service block, .env template, and dashboard setup instructions.",
  "version": "v1",
  "input_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "service": {
        "type": "string",
        "description": "Service name (must match the app service name in docker-compose.yml)."
      },
      "port": {
        "type": "integer",
        "description": "Port the service listens on inside the container."
      },
      "hostname": {
        "type": "string",
        "description": "Public hostname in subdomain.domain format (e.g. archi-mcp.matthewdart.name)."
      },
      "network_mode": {
        "type": "string",
        "enum": ["service", "host"],
        "description": "Networking strategy: 'service' (cloudflared shares app network namespace) or 'host' (both use host networking).",
        "default": "service"
      },
      "output_dir": {
        "type": ["string", "null"],
        "description": "Directory to write generated files. If null, no files are written.",
        "default": null
      },
      "dry_run": {
        "type": "boolean",
        "description": "If true, generate config strings but do not write any files even if output_dir is set.",
        "default": false
      }
    },
    "required": ["service", "port", "hostname"]
  },
  "output_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "service": {
        "type": "string",
        "description": "The service name that was configured."
      },
      "port": {
        "type": "integer",
        "description": "The port that was configured."
      },
      "hostname": {
        "type": "string",
        "description": "The public hostname that was configured."
      },
      "network_mode": {
        "type": "string",
        "description": "The networking strategy used: 'service' or 'host'."
      },
      "compose_block": {
        "type": "string",
        "description": "Generated YAML block for the cloudflared sidecar service."
      },
      "env_block": {
        "type": "string",
        "description": "Generated .env template with the CF_TUNNEL_TOKEN placeholder."
      },
      "instructions": {
        "type": "string",
        "description": "Human-readable Cloudflare dashboard setup instructions."
      },
      "generated_files": {
        "type": "array",
        "description": "List of file paths written to disk. Empty if dry_run is true or output_dir is null.",
        "items": {
          "type": "string"
        }
      }
    },
    "required": ["service", "port", "hostname", "network_mode", "compose_block", "env_block", "instructions", "generated_files"]
  },
  "errors": [
    {
      "code": "invalid_hostname",
      "description": "Hostname is not in subdomain.domain format."
    }
  ],
  "side_effects": "Optionally writes cloudflared-compose-block.yml and cloudflared-env-block.txt to the specified output directory. Does not interact with the Cloudflare API.",
  "version_notes": "v1 migrated from setup-cloudflare-tunnel skill script."
}
