{
  "name": "infra.check_fleet",
  "description": "Verify health of all MCP services across local (SSH to VM) and tunnel (Cloudflare HTTPS) surfaces.",
  "version": "v1",
  "input_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "scope": {
        "type": "string",
        "enum": [
          "local",
          "tunnel",
          "full"
        ],
        "default": "full",
        "description": "Check scope: 'local' (SSH to VM), 'tunnel' (Cloudflare HTTPS), or 'full' (both)."
      },
      "host": {
        "type": "string",
        "default": "ubuntu@matthews-oracle-instance",
        "description": "SSH host target for local checks."
      },
      "services": {
        "type": [
          "array",
          "null"
        ],
        "description": "Specific service names to check. If null, checks all registered services.",
        "items": {
          "type": "string"
        },
        "default": null
      }
    }
  },
  "output_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "properties": {
      "fleet_status": {
        "type": "string",
        "enum": [
          "ok",
          "degraded",
          "error"
        ],
        "description": "Aggregate status across all checked services."
      },
      "checked_at": {
        "type": "string",
        "description": "ISO 8601 timestamp of the check."
      },
      "scope": {
        "type": "string",
        "description": "The scope that was checked."
      },
      "services": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "status": {
              "type": "string",
              "enum": [
                "ok",
                "degraded",
                "error",
                "unreachable"
              ]
            },
            "local": {
              "type": "object"
            },
            "tunnel": {
              "type": "object"
            }
          }
        }
      }
    },
    "required": [
      "fleet_status",
      "checked_at",
      "scope",
      "services"
    ]
  },
  "errors": [
    {
      "code": "dependency_error",
      "description": "ssh or curl not found in PATH."
    },
    {
      "code": "ssh_error",
      "description": "SSH connection to the VM failed."
    }
  ],
  "side_effects": "Runs read-only SSH commands and HTTP requests. Triggers one trivial MCP tool call per service for smoke testing."
}
