{
  "name": "infra.check_fleet",
  "description": "Check health of all deployed MCP services locally and via Cloudflare tunnel (HTTPS). Returns per-service status and an aggregate health summary.",
  "version": "v1",
  "annotations": {
    "title": "Check All MCP Service Health",
    "readOnlyHint": true,
    "idempotentHint": true,
    "openWorldHint": true
  },
  "input_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "scope": {
        "type": "string",
        "enum": [
          "local",
          "tunnel",
          "full"
        ],
        "default": "full",
        "description": "'local' (Docker + localhost), 'tunnel' (Cloudflare HTTPS), or 'full' (both)."
      },
      "services": {
        "type": [
          "array",
          "null"
        ],
        "description": "Specific service names to check. If null, checks all registered services.",
        "items": {
          "type": "string"
        },
        "default": null
      }
    }
  },
  "output_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "properties": {
      "fleet_status": {
        "type": "string",
        "enum": [
          "ok",
          "degraded",
          "error"
        ],
        "description": "Aggregate status across all checked services."
      },
      "checked_at": {
        "type": "string",
        "description": "ISO 8601 timestamp of the check."
      },
      "scope": {
        "type": "string",
        "description": "The scope that was checked."
      },
      "services": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "status": {
              "type": "string",
              "enum": [
                "ok",
                "degraded",
                "error",
                "unreachable"
              ]
            },
            "local": {
              "type": "object"
            },
            "tunnel": {
              "type": "object"
            }
          }
        }
      }
    },
    "required": [
      "fleet_status",
      "checked_at",
      "scope",
      "services"
    ]
  },
  "errors": [
    {
      "code": "dependency_error",
      "description": "docker or curl not found in PATH."
    }
  ],
  "side_effects": "Runs read-only Docker and curl commands locally, and HTTP requests via Cloudflare tunnels. Triggers one trivial MCP tool call per service for smoke testing."
}
