{
  "name": "github.push_ghcr",
  "description": "Build a Docker image for a specified platform and push it to GitHub Container Registry (GHCR).",
  "version": "v1",
  "annotations": {
    "title": "Build & Push Docker Image to GHCR",
    "destructiveHint": true,
    "openWorldHint": true
  },
  "input_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "repo": {
        "type": "string",
        "description": "GitHub repository in owner/name format (e.g. 'matthewdart/myapp'). Used to form the GHCR image path ghcr.io/<repo>."
      },
      "context": {
        "type": "string",
        "description": "Docker build context path (e.g. '.' or './app')."
      },
      "dockerfile": {
        "type": "string",
        "description": "Path to the Dockerfile relative to the build context.",
        "default": "Dockerfile"
      },
      "platform": {
        "type": "string",
        "description": "Target platform for the Docker build (e.g. 'linux/arm64', 'linux/amd64').",
        "default": "linux/arm64"
      },
      "tags": {
        "type": "array",
        "description": "List of image tags to apply. Defaults to [\"latest\"].",
        "items": {
          "type": "string"
        },
        "default": [
          "latest"
        ]
      },
      "dry_run": {
        "type": "boolean",
        "description": "If true, return the docker command that would be executed without running it.",
        "default": false
      }
    },
    "required": [
      "repo",
      "context"
    ]
  },
  "output_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "image": {
        "type": "string",
        "description": "The full GHCR image path (ghcr.io/<repo>)."
      },
      "tags": {
        "type": "array",
        "description": "Tags applied to the image.",
        "items": {
          "type": "string"
        }
      },
      "platform": {
        "type": "string",
        "description": "Target platform used for the build."
      },
      "action": {
        "type": "string",
        "description": "The action performed: dry_run, pushed, or failed."
      },
      "docker_command": {
        "type": "array",
        "description": "Full docker command array. Only present for dry_run.",
        "items": {
          "type": "string"
        }
      },
      "exit_code": {
        "type": "integer",
        "description": "Exit code from the docker command. Only present on failure."
      },
      "error": {
        "type": "string",
        "description": "Error message from docker, if any."
      }
    },
    "required": [
      "image",
      "tags",
      "platform",
      "action"
    ]
  },
  "errors": [
    {
      "code": "dependency_error",
      "description": "docker binary not found in PATH."
    },
    {
      "code": "build_push_error",
      "description": "docker buildx build --push command failed with a non-zero exit code."
    }
  ],
  "side_effects": "Builds a Docker image via buildx and pushes it to GitHub Container Registry.",
  "version_notes": "v1 migrated from ghcr-push skill script."
}
