{
  "name": "infra.discover_stacks",
  "description": "Scan /opt for deployable Docker Compose stacks.",
  "version": "v1",
  "annotations": {
    "title": "Discover Stacks",
    "readOnlyHint": true,
    "idempotentHint": true,
    "openWorldHint": true
  },
  "input_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "host": {
        "type": "string",
        "description": "'local' (default) or SSH host alias.",
        "default": "local"
      },
      "base_dir": {
        "type": "string",
        "description": "Base directory to scan for stacks.",
        "default": "/opt"
      }
    },
    "required": []
  },
  "output_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "host": {
        "type": "string"
      },
      "base_dir": {
        "type": "string"
      },
      "stack_count": {
        "type": "integer"
      },
      "stacks": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "has_override": { "type": "boolean" },
            "has_env": { "type": "boolean" },
            "has_template": { "type": "boolean" },
            "status": { "type": "string" }
          }
        }
      }
    },
    "required": ["host", "base_dir", "stack_count", "stacks"]
  },
  "errors": [
    { "code": "dependency_error", "description": "ssh binary not found in PATH." },
    { "code": "ssh_error", "description": "SSH connection or remote command execution failed." }
  ],
  "side_effects": "Scans directories and checks Docker Compose status (locally or via SSH).",
  "version_notes": "v1 initial implementation."
}
