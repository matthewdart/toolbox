{
  "name": "infra.bootstrap_vm",
  "description": "Preflight check for VM deployment readiness. Connects via SSH and verifies Docker, Docker Compose, architecture, GHCR authentication, Tailscale, and per-service compose directory layout.",
  "version": "v1",
  "annotations": {
    "title": "Preflight VM Readiness Check",
    "readOnlyHint": true,
    "idempotentHint": true,
    "openWorldHint": true
  },
  "input_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "host": {
        "type": "string",
        "description": "SSH host target (e.g. user@hostname or an SSH config alias)."
      },
      "compose_dirs": {
        "type": "array",
        "description": "Absolute paths to Docker Compose project directories on the remote host.",
        "items": {
          "type": "string"
        },
        "default": [
          "/opt/remarkable-pipeline",
          "/opt/health-ledger",
          "/opt/archi-mcp-bridge"
        ]
      }
    },
    "required": [
      "host"
    ]
  },
  "output_schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "host": {
        "type": "string",
        "description": "The SSH host that was checked."
      },
      "compose_dirs": {
        "type": "array",
        "description": "The compose directories that were verified.",
        "items": {
          "type": "string"
        }
      },
      "all_ok": {
        "type": "boolean",
        "description": "True if every check passed."
      },
      "checks": {
        "type": "object",
        "description": "Map of check name to status string (ok or fail).",
        "additionalProperties": {
          "type": "string"
        }
      },
      "details": {
        "type": "array",
        "description": "Full detail objects for each check.",
        "items": {
          "type": "object",
          "properties": {
            "check": {
              "type": "string",
              "description": "Name of the check."
            },
            "status": {
              "type": "string",
              "description": "ok or fail."
            },
            "detail": {
              "type": "string",
              "description": "Output or error detail from the check."
            },
            "hint": {
              "type": "string",
              "description": "Remediation hint when the check fails."
            }
          },
          "required": [
            "check",
            "status",
            "detail"
          ]
        }
      }
    },
    "required": [
      "host",
      "compose_dirs",
      "all_ok",
      "checks",
      "details"
    ]
  },
  "errors": [
    {
      "code": "dependency_error",
      "description": "ssh binary not found in PATH."
    },
    {
      "code": "ssh_error",
      "description": "SSH connection failed for one or more checks."
    }
  ],
  "side_effects": "Executes read-only commands on the remote host via SSH to verify deployment prerequisites. No state is modified.",
  "version_notes": "v1 migrated from vm-bootstrap preflight skill script."
}
