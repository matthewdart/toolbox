# Capabilities

This file is the registry (index) of capabilities in this repository.

Each capability is a self-contained plugin under `capabilities/`, containing its contract, implementation, documentation, and adapter files. The registry auto-discovers plugins at import time â€” no manual wiring is needed.

## Plugin Structure

```
capabilities/<capability_dir>/
  __init__.py          # declares CAPABILITY_ID, ENTRY_POINT_MODULE, ENTRY_POINT_ATTR
  contract.v1.json     # canonical contract (JSON Schema v7)
  implementation.py    # surface-agnostic implementation
  README.md            # capability documentation
  adapters/
    openai.json        # OpenAI tool definition (generated by toolgen)
    codex.md           # Codex adapter documentation (optional)
```

## Implemented

| Capability | Plugin Dir | Surfaces | Description |
| --- | --- | --- | --- |
| `bsport.list_offers` | `bsport_list_offers` | OpenAI, MCP, CLI, Codex | Fetch upcoming bsport offers with filters |
| `text.normalize_markdown` | `text_normalize_markdown` | OpenAI, MCP, CLI | Normalize Markdown text via deterministic whitespace rules |
| `media.analyze_video` | `media_analyze_video` | OpenAI, MCP, CLI | Transcribe a video and extract key slides using OpenAI APIs |
| `media.download_video` | `media_download_video` | OpenAI, MCP, CLI | Download a video from a URL using yt-dlp |
| `openai.calculate_usage_cost` | `openai_calculate_usage_cost` | OpenAI, MCP, CLI | Summarize OpenAI usage logs and estimate costs |
| `canvas.extract_markdown` | `canvas_extract_markdown` | OpenAI, MCP, CLI | Extract markdown from a ChatGPT Canvas shared URL |
| `gist.create_private` | `gist_create_private` | OpenAI, MCP, CLI | Create a secret GitHub Gist from files or inline content |
| `browser.export_cookies` | `browser_export_cookies` | MCP, CLI | Export browser cookies to a Netscape cookies.txt file |

---

## `bsport.list_offers`

Fetch upcoming offers for a bsport company with optional filters.

- **Plugin**: `capabilities/bsport_list_offers/`
- **Contract**: `capabilities/bsport_list_offers/contract.v1.json`
- **Implementation**: `capabilities/bsport_list_offers/implementation.py`

### CLI usage

```bash
python -m core.dispatch --capability bsport.list_offers --input-json '{"company":995,"days":7}'
```

Via Codex skill adapter:

```bash
./skills/harmonytime_classes --days 7 --activity yoga
```

---

## `text.normalize_markdown`

Normalize Markdown text using deterministic whitespace rules.

- **Plugin**: `capabilities/text_normalize_markdown/`
- **Contract**: `capabilities/text_normalize_markdown/contract.v1.json`
- **Implementation**: `capabilities/text_normalize_markdown/implementation.py`

### CLI usage

```bash
python -m core.dispatch --capability text.normalize_markdown --input-json '{"text":"hello  \nworld"}'
```

---

## `media.analyze_video`

Transcribe a local video file and extract key slide images using OpenAI APIs.

- **Plugin**: `capabilities/media_analyze_video/`
- **Contract**: `capabilities/media_analyze_video/contract.v1.json`
- **Implementation**: `capabilities/media_analyze_video/implementation.py`

### CLI usage

```bash
python -m core.dispatch --capability media.analyze_video --input-json '{"video_path":"/tmp/example.mp4"}'
```

---

## `media.download_video`

Download a video from a URL using yt-dlp and return local file paths + metadata.

- **Plugin**: `capabilities/media_download_video/`
- **Contract**: `capabilities/media_download_video/contract.v1.json`
- **Implementation**: `capabilities/media_download_video/implementation.py`

### CLI usage

```bash
python -m core.dispatch --capability media.download_video --input-json '{"url":"https://example.com/video"}'
```

---

## `openai.calculate_usage_cost`

Summarize OpenAI usage from a JSONL log and optionally calculate estimated costs.

- **Plugin**: `capabilities/openai_calculate_usage_cost/`
- **Contract**: `capabilities/openai_calculate_usage_cost/contract.v1.json`
- **Implementation**: `capabilities/openai_calculate_usage_cost/implementation.py`

### CLI usage

```bash
python -m core.dispatch --capability openai.calculate_usage_cost --input-json '{"usage_log_path":"/path/to/openai_usage.jsonl"}'
```

---

## `canvas.extract_markdown`

Extract embedded markdown from a shared ChatGPT Canvas page.

- **Plugin**: `capabilities/canvas_extract_markdown/`
- **Contract**: `capabilities/canvas_extract_markdown/contract.v1.json`
- **Implementation**: `capabilities/canvas_extract_markdown/implementation.py`

### CLI usage

```bash
python -m core.dispatch --capability canvas.extract_markdown --input-json '{"url":"https://chatgpt.com/canvas/shared/..."}'
```

---

## `gist.create_private`

Create a secret GitHub Gist from files or inline content.

- **Plugin**: `capabilities/gist_create_private/`
- **Contract**: `capabilities/gist_create_private/contract.v1.json`
- **Implementation**: `capabilities/gist_create_private/implementation.py`

### CLI usage

```bash
python -m core.dispatch --capability gist.create_private --input-json '{"content":"hello world","filename":"hello.txt"}'
```

---

## Legacy Skills

---

## `browser.export_cookies`

Export browser cookies for a domain to a Netscape-format cookies.txt file. Pairs with `media.download_video` for login-gated sites.

- **Plugin**: `capabilities/browser_export_cookies/`
- **Contract**: `capabilities/browser_export_cookies/contract.v1.json`
- **Implementation**: `capabilities/browser_export_cookies/implementation.py`

### CLI usage

```bash
python -m core.dispatch --capability browser.export_cookies --input-json '{"browser":"safari","domain":"brighttalk.com","output":"/tmp/cookies.txt"}'
```

The following Codex skills remain under `skills/` as thin CLI wrappers:

| Skill | Description | Delegates to |
| --- | --- | --- |
| `harmonytime-classes` | CLI wrapper with Harmony Time defaults | `bsport.list_offers` |

The `canvas-markdown` and `create-private-gist` skills have been promoted to full capabilities (`canvas.extract_markdown` and `gist.create_private`).

---

## Naming (preferred for new capabilities)

```
<domain>.<verb>_<object>
```

Examples: `text.extract_metadata`, `files.embed_images`, `archimate.sync_model`
